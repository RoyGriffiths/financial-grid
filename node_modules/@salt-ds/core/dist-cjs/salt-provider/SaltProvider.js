'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var jsxRuntime = require('react/jsx-runtime');
var clsx = require('clsx');
var React = require('react');
require('../aria-announcer/AriaAnnouncerContext.js');
require('../utils/useFloatingUI/useFloatingUI.js');
require('../utils/useId.js');
var useIsomorphicLayoutEffect = require('../utils/useIsomorphicLayoutEffect.js');
var ViewportProvider = require('../viewport/ViewportProvider.js');
var AriaAnnouncerProvider = require('../aria-announcer/AriaAnnouncerProvider.js');
var Breakpoints = require('../breakpoints/Breakpoints.js');
var SaltProvider$1 = require('./SaltProvider.css.js');
var window = require('@salt-ds/window');
var styles = require('@salt-ds/styles');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);

const DEFAULT_DENSITY = "medium";
const DEFAULT_THEME_NAME = "salt-theme";
const DEFAULT_MODE = "light";
const DensityContext = React.createContext(DEFAULT_DENSITY);
const ThemeContext = React.createContext({
  theme: "",
  mode: DEFAULT_MODE
});
const BreakpointContext = React.createContext(Breakpoints.DEFAULT_BREAKPOINTS);
const createThemedChildren = (children, themeName, density, mode, applyClassesTo) => {
  var _a;
  const themeNames = themeName === DEFAULT_THEME_NAME ? [DEFAULT_THEME_NAME] : [DEFAULT_THEME_NAME, themeName];
  if (applyClassesTo === "root") {
    return children;
  } else if (applyClassesTo === "child") {
    if (React__default["default"].isValidElement(children)) {
      return React__default["default"].cloneElement(children, {
        className: clsx.clsx(
          (_a = children.props) == null ? void 0 : _a.className,
          ...themeNames,
          `salt-density-${density}`
        ),
        "data-mode": mode
      });
    } else {
      console.warn(
        `
SaltProvider can only apply CSS classes for theming to a single nested child element of the SaltProvider.
        Either wrap elements with a single container or consider removing the applyClassesToChild prop, in which case a
        div element will wrap your child elements`
      );
      return children;
    }
  } else {
    return /* @__PURE__ */ jsxRuntime.jsx("div", {
      className: clsx.clsx(
        `salt-provider`,
        ...themeNames,
        `salt-density-${density}`
      ),
      "data-mode": mode,
      children
    });
  }
};
function InternalSaltProvider({
  applyClassesTo: applyClassesToProp,
  children,
  density: densityProp,
  theme: themeProp,
  mode: modeProp,
  breakpoints: breakpointsProp
}) {
  var _a;
  const inheritedDensity = React.useContext(DensityContext);
  const { theme: inheritedThemes, mode: inheritedMode } = useTheme();
  const isRoot = inheritedThemes === void 0 || inheritedThemes === "";
  const density = (_a = densityProp != null ? densityProp : inheritedDensity) != null ? _a : DEFAULT_DENSITY;
  const themeName = themeProp != null ? themeProp : inheritedThemes === "" ? DEFAULT_THEME_NAME : inheritedThemes;
  const mode = modeProp != null ? modeProp : inheritedMode;
  const breakpoints = breakpointsProp != null ? breakpointsProp : Breakpoints.DEFAULT_BREAKPOINTS;
  const applyClassesTo = applyClassesToProp != null ? applyClassesToProp : isRoot ? "root" : "scope";
  const themeContextValue = React.useMemo(
    () => ({ theme: themeName, mode }),
    [themeName, mode]
  );
  const themedChildren = createThemedChildren(
    children,
    themeName,
    density,
    mode,
    applyClassesTo
  );
  const targetWindow = window.useWindow();
  styles.useComponentCssInjection({
    testId: "salt-provider",
    css: SaltProvider$1,
    window: targetWindow
  });
  useIsomorphicLayoutEffect.useIsomorphicLayoutEffect(() => {
    const themeNames = themeName === DEFAULT_THEME_NAME ? [DEFAULT_THEME_NAME] : [DEFAULT_THEME_NAME, themeName];
    if (applyClassesTo === "root" && targetWindow) {
      if (isRoot) {
        targetWindow.document.documentElement.classList.add(
          ...themeNames,
          `salt-density-${density}`
        );
        targetWindow.document.documentElement.dataset.mode = mode;
      } else {
        console.warn(
          "\nSaltProvider can only apply CSS classes to the root if it is the root level SaltProvider."
        );
      }
    }
    return () => {
      if (applyClassesTo === "root" && targetWindow) {
        targetWindow.document.documentElement.classList.remove(
          ...themeNames,
          `salt-density-${density}`
        );
        targetWindow.document.documentElement.dataset.mode = void 0;
      }
    };
  }, [applyClassesTo, density, isRoot, mode, themeName, targetWindow]);
  const saltProvider = /* @__PURE__ */ jsxRuntime.jsx(DensityContext.Provider, {
    value: density,
    children: /* @__PURE__ */ jsxRuntime.jsx(ThemeContext.Provider, {
      value: themeContextValue,
      children: /* @__PURE__ */ jsxRuntime.jsx(BreakpointContext.Provider, {
        value: breakpoints,
        children: /* @__PURE__ */ jsxRuntime.jsx(ViewportProvider.ViewportProvider, {
          children: themedChildren
        })
      })
    })
  });
  if (isRoot) {
    return /* @__PURE__ */ jsxRuntime.jsx(AriaAnnouncerProvider.AriaAnnouncerProvider, {
      children: saltProvider
    });
  } else {
    return saltProvider;
  }
}
function SaltProvider({
  enableStyleInjection,
  ...restProps
}) {
  return /* @__PURE__ */ jsxRuntime.jsx(styles.StyleInjectionProvider, {
    value: enableStyleInjection,
    children: /* @__PURE__ */ jsxRuntime.jsx(InternalSaltProvider, {
      ...restProps
    })
  });
}
const useTheme = () => {
  return React.useContext(ThemeContext);
};
function useDensity(density) {
  const densityFromContext = React.useContext(DensityContext);
  return density || densityFromContext || DEFAULT_DENSITY;
}
const useBreakpoints = () => {
  return React.useContext(BreakpointContext);
};

exports.BreakpointContext = BreakpointContext;
exports.DEFAULT_DENSITY = DEFAULT_DENSITY;
exports.DensityContext = DensityContext;
exports.SaltProvider = SaltProvider;
exports.ThemeContext = ThemeContext;
exports.useBreakpoints = useBreakpoints;
exports.useDensity = useDensity;
exports.useTheme = useTheme;
//# sourceMappingURL=SaltProvider.js.map
